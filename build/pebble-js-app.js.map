{"version":3,"sources":["webpack/bootstrap a1de323406bc0db8cf90","/home/vscode/.pebble-sdk/SDKs/4.9.77/sdk-core/pebble/common/include/_pkjs_shared_additions.js","./src/pkjs/index.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;;;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;;AAEA,EAAC;;;;;;;ACnCD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,6CAA4C;;AAE5C;AACA;AACA,8CAA6C;;AAE7C;AACA;AACA,cAAa;AACb,IAAG;AACH,cAAa;AACb,IAAG;AACH,cAAa;AACb,IAAG;AACH,cAAa;AACb;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW;AACX;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,MAAK;AACL;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG,iBAAiB;AACpB,EAAC;;AAED;AACA;AACA;AACA,EAAC","file":"pebble-js-app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap a1de323406bc0db8cf90","/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n(function(p) {\n  if (!p === undefined) {\n    console.error('Pebble object not found!?');\n    return;\n  }\n\n  // Aliases:\n  p.on = p.addEventListener;\n  p.off = p.removeEventListener;\n\n  // For Android (WebView-based) pkjs, print stacktrace for uncaught errors:\n  if (typeof window !== 'undefined' && window.addEventListener) {\n    window.addEventListener('error', function(event) {\n      if (event.error && event.error.stack) {\n        console.error('' + event.error + '\\n' + event.error.stack);\n      }\n    });\n  }\n\n})(Pebble);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// /home/vscode/.pebble-sdk/SDKs/4.9.77/sdk-core/pebble/common/include/_pkjs_shared_additions.js\n// module id = 1\n// module chunks = 0","// OpenWeatherMap API Key - Get one free at https://openweathermap.org/appid\n// The API key is automatically injected from WEATHER_SECRET environment variable during build\n// WEATHER_API_KEY_PLACEHOLDER will be replaced with the actual key during build\nvar myAPIKey = 'WEATHER_API_KEY_PLACEHOLDER';\n\n// Log API key status (first 8 chars only for security)\nconsole.log('API Key loaded: ' + (myAPIKey && myAPIKey !== 'WEATHER_API_KEY_PLACEHOLDER' ? myAPIKey.substring(0, 8) + '...' : 'MISSING'));\nif (!myAPIKey || myAPIKey === 'WEATHER_API_KEY_PLACEHOLDER') {\n  console.error('WARNING: No API key found! Set WEATHER_SECRET environment variable and rebuild.');\n}\n\n// BATTERY OPTIMIZATION STRATEGY:\n// - GPS cached for 3 hours (major battery saver - GPS is expensive)\n// - Weather fetched every 15 minutes using cached GPS\n// - Weather refreshed at startup and when data is older than 15 minutes\n// - Only updates when data actually changes\n\n// GPS cache - updated every 3 hours\nvar cachedLocation = null;\nvar lastLocationTime = 0;\nvar GPS_CACHE_DURATION = 3 * 60 * 60 * 1000; // 3 hours in milliseconds\n\n// Weather update tracking\nvar lastWeatherUpdate = 0;\nvar WEATHER_UPDATE_INTERVAL = 15 * 60 * 1000; // 15 minutes in milliseconds\n\nfunction iconFromWeatherId(weatherId) {\n  if (weatherId < 600) {\n    return 2; // Rain\n  } else if (weatherId < 700) {\n    return 3; // Snow\n  } else if (weatherId > 800) {\n    return 1; // Clouds\n  } else {\n    return 0; // Clear\n  }\n}\n\nfunction fetchWeather(latitude, longitude) {\n  if (!myAPIKey) {\n    console.error('Cannot fetch weather: API key is missing!');\n    return;\n  }\n  \n  var url = 'http://api.openweathermap.org/data/2.5/forecast?' +\n    'lat=' + latitude + '&lon=' + longitude + '&cnt=1&appid=' + myAPIKey;\n  console.log('Fetching forecast from: ' + url.replace(myAPIKey, 'API_KEY'));\n  \n  var req = new XMLHttpRequest();\n  req.open('GET', url, true);\n  req.onload = function () {\n    if (req.readyState === 4) {\n      if (req.status === 200) {\n        console.log('Forecast API Response: ' + req.responseText);\n        var response = JSON.parse(req.responseText);\n        // Get the first forecast entry (next 3-hour period)\n        var forecast = response.list[0];\n        var temperature = Math.round(forecast.main.temp - 273.15);\n        var icon = iconFromWeatherId(forecast.weather[0].id);\n        var condition = forecast.weather[0].main.toLowerCase();\n        console.log('Forecast Temperature: ' + temperature);\n        console.log('Forecast Icon: ' + icon);\n        console.log('Forecast Condition: ' + condition);\n        \n        // Send using numeric keys\n        var dict = {\n          0: icon,              // WEATHER_ICON_KEY\n          1: temperature,       // WEATHER_TEMPERATURE_KEY\n          2: condition          // WEATHER_CITY_KEY (now condition)\n        };\n        console.log('Sending to watch: ' + JSON.stringify(dict));\n        Pebble.sendAppMessage(dict,\n          function(e) {\n            console.log('Weather sent successfully!');\n            lastWeatherUpdate = Date.now();\n          },\n          function(e) {\n            console.log('Failed to send weather: ' + JSON.stringify(e));\n          }\n        );\n      } else {\n        console.log('Weather API Error: ' + req.status);\n        console.log('Response: ' + req.responseText);\n      }\n    }\n  };\n  req.onerror = function() {\n    console.log('Weather API request failed');\n  };\n  req.send(null);\n}\n\nfunction locationSuccess(pos) {\n  var coordinates = pos.coords;\n  // Cache the location\n  cachedLocation = {\n    latitude: coordinates.latitude,\n    longitude: coordinates.longitude\n  };\n  lastLocationTime = Date.now();\n  console.log('GPS location cached: ' + cachedLocation.latitude + ', ' + cachedLocation.longitude);\n  \n  fetchWeather(coordinates.latitude, coordinates.longitude);\n}\n\nfunction locationError(err) {\n  console.warn('location error (' + err.code + '): ' + err.message);\n  \n  // If we have a cached location, use it\n  if (cachedLocation) {\n    console.log('Using cached location due to GPS error');\n    fetchWeather(cachedLocation.latitude, cachedLocation.longitude);\n  } else {\n    Pebble.sendAppMessage({\n      2: 'error',        // WEATHER_CITY_KEY\n      1: 0               // WEATHER_TEMPERATURE_KEY\n    },\n    function(e) {\n      console.log('Error message sent to watch');\n    },\n    function(e) {\n      console.log('Failed to send error to watch');\n    });\n  }\n}\n\nfunction getWeather(forceUpdate) {\n  var now = Date.now();\n  var timeSinceLastLocation = now - lastLocationTime;\n  var timeSinceLastWeather = now - lastWeatherUpdate;\n  \n  // Force update if requested, at startup, or if weather is older than 15 minutes\n  if (forceUpdate || lastWeatherUpdate === 0 || timeSinceLastWeather >= WEATHER_UPDATE_INTERVAL) {\n    console.log('Weather update needed (age: ' + Math.round(timeSinceLastWeather / 60000) + ' minutes)');\n    \n    // If we have a cached location and it's less than 3 hours old, use it\n    if (cachedLocation && timeSinceLastLocation < GPS_CACHE_DURATION) {\n      console.log('Using cached GPS location (age: ' + Math.round(timeSinceLastLocation / 60000) + ' minutes)');\n      fetchWeather(cachedLocation.latitude, cachedLocation.longitude);\n    } else {\n      // Location is stale or doesn't exist, get fresh GPS\n      console.log('Requesting fresh GPS location (cache age: ' + Math.round(timeSinceLastLocation / 60000) + ' minutes)');\n      window.navigator.geolocation.getCurrentPosition(locationSuccess, locationError, locationOptions);\n    }\n  } else {\n    console.log('Weather is fresh, skipping update (age: ' + Math.round(timeSinceLastWeather / 60000) + ' minutes)');\n  }\n}\n\nvar locationOptions = {\n  'timeout': 15000,\n  'maximumAge': 60000\n};\n\nPebble.addEventListener('ready', function (e) {\n  console.log('PebbleKit JS ready!');\n  \n  // Force fetch weather on startup to ensure fresh data\n  getWeather(true);\n  \n  // Check for weather updates every 5 minutes, but only fetch if data is stale\n  setInterval(function() {\n    console.log('Checking if weather update needed...');\n    getWeather();\n  }, 5 * 60 * 1000); // Check every 5 minutes\n});\n\nPebble.addEventListener('appmessage', function (e) {\n  console.log('Received message from watch, requesting weather update');\n  getWeather();\n});\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pkjs/index.js\n// module id = 2\n// module chunks = 0"],"sourceRoot":""}